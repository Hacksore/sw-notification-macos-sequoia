<html>

<head>
  <title>Repro SW Bug</title>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        const swButton = document.getElementById('swButton');
        const permButton = document.getElementById('permButton');
        navigator.serviceWorker.register('sw.js').then(function (registration) {
          console.log('Service Worker registered:', registration.active.state);
          swButton.removeAttribute('disabled');
        }, function (err) {
          console.log('Service Worker registration failed:', err);
        });
      });
    }

    function requestPermission() {
      // ask for permission to show notifications
      Notification.requestPermission().then(function (permission) {
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          permButton.setAttribute('disabled', true);
        } else {
          console.log('Notification permission denied.');
        }
      });
    };

    function sendToServiceWorker() {
      navigator.serviceWorker.controller.postMessage({
        title: 'Hello from the main page!',
      });
    }
  </script>
</head>

<body>
  <h1>Repro</h1>
  <p>Enable perms && send to service worker</p>
  <button id="permButton" onclick="requestPermission()">Request Notification Permission</button>
  <button id="swButton" disabled onclick="sendToServiceWorker()">send to service woker</button>
</body>

</html>
